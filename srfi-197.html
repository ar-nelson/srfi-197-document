<!DOCTYPE html><html><head>
            <meta charset="utf-8">
            <meta name="metadata:tags" content="">
<meta name="metadata:attachments" content="">
<meta name="metadata:deleted" content="false">
<meta name="metadata:favorited" content="false">
<meta name="metadata:pinned" content="false">
<meta name="metadata:created" content="2020-06-08T01:35:22.360Z">
<meta name="metadata:modified" content="2020-06-08T04:00:10.365Z">
            <title>SRFI: Threading Macros</title>
            <link rel="shortcut icon" type="image/png" href="data:image/png;base64,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">
            
            
            
          <style data-critical="true">*{border-color:inherit}*,::after,::before{box-sizing:inherit}html{box-sizing:border-box}*,::after,::before{flex-shrink:1}a,area,button,input,label,select,summary,textarea{touch-action:manipulation}html{font-family:sans-serif;line-height:1.15;text-size-adjust:100%}body{margin:0px}h1{font-size:2em;margin:0.67em 0px}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}a:active,a:hover{outline-width:0px}code,kbd,samp{font-family:monospace,monospace;font-size:1em}html{font-size:16px;-webkit-tap-highlight-color:transparent}body,html{height:100%}body{font-size:1rem;line-height:1.375;user-select:none !important}body,input,textarea{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif;font-size:16px}.button,.card,.card-block:not(.multiple),.card-footer:not(.multiple),.card-header:not(.multiple),.centerer,.container,.infobar,.label,.select,.spacer,.tagbox,.widget,address,dl,fieldset,footer,form,h1,h2,h3,h4,h5,h6,header,i.icon,img,input,label,ol,p,pre,textarea,ul{position:relative;margin:0px 0px 0.625rem}.button:last-child,.card-block:last-child:not(.multiple),.card-footer:last-child:not(.multiple),.card-header:last-child:not(.multiple),.card:last-child,.centerer:last-child,.container:last-child,.infobar:last-child,.label:last-child,.select:last-child,.spacer:last-child,.tagbox:last-child,.widget:last-child,address:last-child,dl:last-child,fieldset:last-child,footer:last-child,form:last-child,h1:last-child,h2:last-child,h3:last-child,h4:last-child,h5:last-child,h6:last-child,header:last-child,i.icon:last-child,img:last-child,input:last-child,label:last-child,ol:last-child,p:last-child,pre:last-child,textarea:last-child,ul:last-child{margin-bottom:0px}*{transition:opacity 0.15s ease 0s}.small,h5{font-size:0.840901em}.infobar-title:not(.xxxxsmall):not(.xxxsmall):not(.xxsmall):not(.xsmall):not(.small):not(.medium):not(.large):not(.xlarge):not(.xxlarge):not(.xxxlarge):not(.xxxxlarge),.large,h3{font-size:1.1892em}.xlarge,h2{font-size:1.5em}.xxlarge,h1{font-size:1.68176em}.button:target,.card:target,.container:target,.infobar:target,.label:target,.target,input:target,pre:target,textarea:target{animation:0.9s ease-in-out 0s 1 normal none running target}.select select + label::after,i.icon{display:inline-block;vertical-align:middle;font-family:"Material Icons";font-weight:400;font-style:normal;font-size:1.5em;width:1em;height:1em;line-height:1;letter-spacing:normal;text-transform:none;overflow-wrap:normal;white-space:nowrap;direction:ltr;overflow:hidden;-webkit-font-smoothing:antialiased;text-rendering:optimizelegibility;font-feature-settings:"liga";flex:0 0 auto !important}i.small.icon{font-size:1.26135em}code{font-family:Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;background-color:rgba(0,0,0,0.075);padding:0.09em 0.18em;border-radius:0.375em}pre > code{padding:0px;border:0px;background:transparent}h1,h2,h3,h4,h5,h6{font-family:inherit;font-weight:500}a{touch-action:manipulation;cursor:pointer;overflow-wrap:break-word;word-break:break-word;color:inherit;text-decoration:none}address a:hover,li a:hover,p a:hover,td a:hover,th a:hover{text-decoration:underline}p{word-break:break-word;max-width:100%;overflow-wrap:break-word}p > *{margin-bottom:0px !important}pre{display:flex;padding:0.625rem}.theme-light pre{background-color:rgb(246,248,250);color:rgb(31,31,31)}.theme-light .preview{background-color:rgb(255,255,255);border-color:rgb(230,229,229);color:rgb(31,31,31)}.theme-light .preview h1,.theme-light .preview h2,.theme-light .preview h3,.theme-light .preview h4,.theme-light .preview h5,.theme-light .preview h6{border-color:rgb(234,236,239)}.theme-light .preview h1,.theme-light .preview h2,.theme-light .preview h3,.theme-light .preview h4,.theme-light .preview h5{color:inherit}.theme-light .preview code,.theme-light .preview li code,.theme-light .preview p code,.theme-light .preview table code{background-color:rgba(27,31,35,0.05) !important;color:inherit !important}.theme-light .preview pre code{background-color:transparent !important}.theme-light .preview address a,.theme-light .preview dd a,.theme-light .preview dt a,.theme-light .preview h1 a,.theme-light .preview h2 a,.theme-light .preview h3 a,.theme-light .preview h4 a,.theme-light .preview h5 a,.theme-light .preview h6 a,.theme-light .preview li a,.theme-light .preview p a,.theme-light .preview td a,.theme-light .preview th a{color:rgb(3,102,214)}.theme-light .preview address a:hover,.theme-light .preview dd a:hover,.theme-light .preview dt a:hover,.theme-light .preview h1 a:hover,.theme-light .preview h2 a:hover,.theme-light .preview h3 a:hover,.theme-light .preview h4 a:hover,.theme-light .preview h5 a:hover,.theme-light .preview h6 a:hover,.theme-light .preview li a:hover,.theme-light .preview p a:hover,.theme-light .preview td a:hover,.theme-light .preview th a:hover{color:rgb(3,95,199)}.theme-light .preview address a:active,.theme-light .preview dd a:active,.theme-light .preview dt a:active,.theme-light .preview h1 a:active,.theme-light .preview h2 a:active,.theme-light .preview h3 a:active,.theme-light .preview h4 a:active,.theme-light .preview h5 a:active,.theme-light .preview h6 a:active,.theme-light .preview li a:active,.theme-light .preview p a:active,.theme-light .preview td a:active,.theme-light .preview th a:active{color:rgb(3,88,184)}.preview .copy-wrapper{position:relative;margin-bottom:16px}.preview .copy-wrapper:last-child{margin-bottom:0px}.preview .copy-wrapper .copy{position:absolute;top:0.625rem;right:0.625rem;cursor:pointer;opacity:0;transition:opacity 0.15s ease 0s;z-index:1}.preview .copy-wrapper:hover .copy{opacity:0.5}.preview .copy-wrapper:hover .copy:hover{opacity:0.75}.preview .copy-wrapper:hover .copy:active{opacity:1}.preview .copy-wrapper > pre{margin-bottom:0px !important}.preview code,.preview pre{direction:ltr;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;hyphens:none;line-height:1.4;margin:1em 0px;overflow:auto;padding:1.2em;tab-size:2;text-align:left;white-space:pre;word-spacing:normal}.preview li code,.preview p code,.preview table code{font-size:85%}.preview{font-size:16px;line-height:inherit;user-select:text !important;padding:1.25rem !important}.preview > :first-child{margin-top:0px !important}.preview > :last-child{margin-bottom:0px !important}.preview blockquote,.preview dl,.preview ol,.preview p,.preview pre,.preview table,.preview ul{margin-top:0px;margin-bottom:16px}.preview blockquote:last-child,.preview dl:last-child,.preview ol:last-child,.preview p:last-child,.preview pre:last-child,.preview table:last-child,.preview ul:last-child{margin-bottom:0px}.preview h1,.preview h2,.preview h3,.preview h4,.preview h5,.preview h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.preview h1:last-child,.preview h2:last-child,.preview h3:last-child,.preview h4:last-child,.preview h5:last-child,.preview h6:last-child{margin-bottom:0px}.preview h1 code,.preview h2 code,.preview h3 code,.preview h4 code,.preview h5 code,.preview h6 code{font-size:inherit}.preview h1{font-size:2em}.preview h1,.preview h2{padding-bottom:0.3em;border-bottom-width:1px;border-bottom-style:solid}.preview h2{font-size:1.5em}.preview h3{font-size:1.25em}.preview a:not([href]){color:inherit;text-decoration:none}.preview pre{display:block;overflow-wrap:normal;padding:16px;overflow:auto;line-height:1.45}.preview code,.preview pre{font-size:85%;border-radius:3px}.preview code{padding:0.2em 0.4em;margin:0px}.preview pre > code{padding:0px;margin:0px;font-size:100%;word-break:normal;white-space:pre;border:0px;background:transparent !important}.preview pre code{display:inline;padding:0px;margin:0px;overflow:visible;line-height:inherit;overflow-wrap:normal;background-color:transparent;border:0px}@font-face{font-family:"Material Icons";font-style:normal;font-weight:400;font-display:block;src:url("data:font/woff2;base64,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") format("woff2")}</style></head>
          <body class="theme-light">
            <div class="preview">
              <h1 id="srfi-threading-macros">SRFI: Threading Macros</h1>
<h2 id="title">Title</h2>
<p>Threading Macros</p>
<h2 id="author">Author</h2>
<p>Adam Nelson</p>
<h2 id="status">Status</h2>
<p>This SRFI is currently in <em>draft</em> status.  Here is <a href="https://srfi.schemers.org/srfi-process.html">an explanation</a> of each status that a SRFI can hold.  To provide input on this SRFI, please send email to <code><a href="mailto:srfi+minus+197+at+srfi+dotschemers+dot+org">srfi-197@<span class="antispam">nospam</span>srfi.schemers.org</a></code>.  To subscribe to the list, follow <a href="https://srfi.schemers.org/srfi-list-subscribe.html">these instructions</a>.  You can access previous messages via the mailing list <a href="https://srfi-email.schemers.org/srfi-197">archive</a>.</p>
<ul>
  <li>Received: 2020-06-07</li>
  <li>60-day deadline: 2020-08-07</li>
  <li>Draft #1 published: 2020-06-08</li>
</ul>
<h2 id="abstract">Abstract</h2>
<p>Threading macros provide a simple, readable way to write deeply-nested expressions. Also known as "arrows", these macros were first introduced in Clojure, and are a key feature of that language. With threading macros, expressions like <code>(append (cons (assoc x y) c) '(a b))</code> can be written as a sequence of operations: <code>(-&gt; x (assoc y) (cons c) (append '(a b))</code>.</p>
<h1 id="issues">Issues</h1>
<p>These are called "Threading macros" in Clojure, but is there a clearer name to use in Scheme? It needs to be clear that these have nothing to do with threads of execution.</p>
<h1 id="rationale">Rationale</h1>
<p>Deeply-nested expressions are a common problem in all functional languages, especially Lisps. Excessive nesting can result in deep indentation and parenthesis matching errors.</p>
<div class="copy-wrapper"><div class="copy" title="Copy Code to Clipboard"><i class="icon small">content_copy</i></div><pre><code>; Quick, how many close parentheses are there? 
(eta (zeta (epsilon (delta (gamma (beta (alpha))))))) 
</code></pre></div>
<p>Additionally, some expressions sound more natural when written inside-out, as a sequence of steps from start to finish.</p>
<div class="copy-wrapper"><div class="copy" title="Copy Code to Clipboard"><i class="icon small">content_copy</i></div><pre><code>; This recipe looks… backwards.
(bake (pour (mix (add (add (add bowl flour) sugar) eggs))) (fahrenheit 350)) 
</code></pre></div>
<p>Many functional languages solve this by introducing function chaining operators (sometimes called "pipeline" operators). Threading macros are a kind of pipeline operator introduced by the Clojure language, but they are trivially portable to any Lisp.</p>
<div class="copy-wrapper"><div class="copy" title="Copy Code to Clipboard"><i class="icon small">content_copy</i></div><pre><code>(-&gt; (alpha) beta gamma delta epsilon zeta eta)

(-&gt; bowl
    (add flour)
    (add sugar)
    (add eggs)
    mix
    pour
    (bake (fahrenheit 350)))
</code></pre></div>
<p>Threading macros are particularly useful for nested list and vector operations, in which it is often difficult to match the last argument (the list or vector) to the correct function call because they may be separated by a multi-line lambda.</p>
<div class="copy-wrapper"><div class="copy" title="Copy Code to Clipboard"><i class="icon small">content_copy</i></div><pre><code>(-&gt;&gt; xs
     (map (lambda (x) (+ x 1))
     (filter odd?)
     (fold * 1))
</code></pre></div>
<h2 id="specification">Specification</h2>
<h3 id="-"><code>-&gt;</code></h3>
<p>The thread-first macro. A pipeline in which each argument after the first is a partial function call. Atoms are converted into one-element lists. The first argument is the initial value. The result of each call is inserted into the next call as its first argument.</p>
<p>Can be trivially implemented with this syntax-rules definition:</p>
<div class="copy-wrapper"><div class="copy" title="Copy Code to Clipboard"><i class="icon small">content_copy</i></div><pre><code>(define-syntax -&gt;
  (syntax-rules ()
    ((-&gt; x) x)
    ((-&gt; x (fn . args) . rest) (-&gt; (fn x . args) . rest))
    ((-&gt; x fn . rest) (-&gt; (fn x) . rest))))
</code></pre></div>
<h3 id="--1"><code>-&gt;&gt;</code></h3>
<p>The thread-last macro. A pipeline in which each argument after the first is a partial function call. Atoms are converted into one-element lists. The first argument is the initial value. The result of each call is inserted into the next call as its last argument.</p>
<p>Can be trivially implemented with this syntax-rules definition:</p>
<div class="copy-wrapper"><div class="copy" title="Copy Code to Clipboard"><i class="icon small">content_copy</i></div><pre><code>(define-syntax -&gt;&gt;
  (syntax-rules ()
    ((-&gt;&gt; x) x)
    ((-&gt;&gt; x (fn args ...) . rest) (-&gt;&gt; (fn args ... x) . rest))
    ((-&gt;&gt; x fn . rest) (-&gt;&gt; (fn x) . rest))))
</code></pre></div>
<h3 id="as-"><code>as-&gt;</code></h3>
<p>The thread-as macro. Takes an initial value and a slot name as its first two arguments. All subsequent arguments are function calls in which the slot name is replaced with the result of the last step in the pipeline.</p>
<p>Can be trivially implemented with this syntax-rules definition:</p>
<div class="copy-wrapper"><div class="copy" title="Copy Code to Clipboard"><i class="icon small">content_copy</i></div><pre><code>(define-syntax as-&gt;
  (syntax-rules ()
    ((as-&gt; x name) x)
    ((as-&gt; x name expr . rest)
      (as-&gt; (let ((name x)) expr) name . rest))))
</code></pre></div>
<h3 id="some--some-"><code>some-&gt;</code>, <code>some-&gt;&gt;</code></h3>
<p>Like <code>-&gt;</code> and <code>-&gt;&gt;</code>, but short-circuit at the first part of the pipeline that returns <code>#f</code>.</p>
<h3 id="cond--cond-"><code>cond-&gt;</code>, <code>cond-&gt;&gt;</code></h3>
<p>Pipelines in which each step has a guard expression. Each argument after the first is a clause <code>(&lt;guard&gt; &lt;call&gt;)</code>, where <code>&lt;call&gt;</code> is a partial function call whose first or last argument will be inserted exactly as in <code>-&gt;</code> or <code>-&gt;&gt;</code>. Clauses with no guard may be written as one-element lists <code>(&lt;call&gt;)</code>, as in <a target="_blank" href="https://srfi.schemers.org/srfi-2/srfi-2.html">SRFI 2</a>. Clauses whose <code>&lt;guard&gt;</code> returns <code>#f</code> will be skipped. Unlike <code>cond</code>, these macros do not short-circuit.</p>
<div class="copy-wrapper"><div class="copy" title="Copy Code to Clipboard"><i class="icon small">content_copy</i></div><pre><code>(define (describe-number n)
  (cond-&gt;&gt; '()
    ((odd? n) (cons "odd"))
    ((even? n) (cons "even"))
    ((zero? n) (cons "zero"))
    ((positive? n) (cons "positive"))))

(describe-number 3) ; =&gt; '("positive" "odd")
(describe-number 4) ; =&gt; '("positive" "even")
</code></pre></div>
<p>Note that the syntax of these macros differs from Clojure's <code>cond-&gt;</code> and <code>cond-&gt;&gt;</code>. Scheme conventionally adds extra grouping parentheses around individual clauses in <code>let</code>, <code>cond</code>, etc., whereas Clojure omits them.</p>
<h3 id="lambda--lambda-"><code>lambda-&gt;</code>, <code>lambda-&gt;&gt;</code></h3>
<p>Create a one-argument procedure from a <code>-&gt;</code> or <code>-&gt;&gt;</code> pipeline. The argument becomes the initial value of the pipeline. <code>(lambda-&gt; x y z)</code> is equivalent to <code>(lambda (a) (-&gt; a x y z))</code>.</p>
<h2 id="implementation">Implementation</h2>
<p><a target="_blank" href="https://github.com/ar-nelson/scheme-threading-macros">A sample implementation is available on GitHub.</a> This implementation uses only simple <code>syntax-rules</code> macros, and should be compatible with every R5RS or higher Scheme. It includes an R7RS library wrapper and a test script.</p>
<h2 id="acknowledgements">Acknowledgements</h2>
<p>Thanks to Rich Hickey for Clojure and the original implementation of these macros, and to Paulus Esterhazy for the (EPL licensed) <a target="_blank" href="https://clojure.org/guides/threading_macros">documentation page</a> from which I took the specification of these macros and some of the examples in this document.</p>
<h2 id="copyright">Copyright</h2>
<p>Copyright © Adam Nelson (2020).</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice (including the next paragraph) shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>

            </div>
          
        
      </body></html>